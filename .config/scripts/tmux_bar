#!/usr/bin/env bash

tmux_bar_sleep1() {
# {{{ #### Update Package
Update=$(apt list --upgradable | sed '/\//!d' | wc -l)
[ "$Update" = 0 ] && echo -n "" || echo -n " #[fg=colour71]┃ #[fg=colour11]📦 Updates: $Update"
#### ━━━━━━━━━━━━━━ # }}}
}

tmux_bar_inst(){
# {{{ #### qBittorrent
Torrent=$($HOME/.config/scripts/qbit \
	| sort \
	| uniq -c \
	| sed 's/^ *//' \
	| sed -r 's/(.*) pausedDL.*/#[fg=colour1] \1🔴/g
		s/(.*) missingFiles.*/#[fg=colour1] \1❗/g
		s/(.*) pausedUP.*/#[fg=colour4] \1✅/g
		s/(.*) stalledUP.*/#[fg=colour71] \1🌱/g
		s/(.*) uploading.*/#[fg=colour71] \1📤/g
		s/(.*) queuedUP.*/#[fg=colour11] \1📎/g
		s/(.*) metaDL.*/#[fg=colour6] \1⌛️/g
		s/.*stalledDL (.*)/#[fg=colour5] ⌛️[\1%]/g
		s/.*downloading (.*)/#[fg=colour5] 📥[\1%]/g
		s/.*moving (.*)/#[fg=colour6] 🗂 [\1%]/g
		s/.*checkingDL (.*)/#[fg=colour11] ⌛️[\1%]/g
		s/.*checkingUP (.*)/#[fg=colour11] ⌛️[\1%]/g' \
	| sed ':a;$!N;s/\n//;ta;' \
	| sed 's/^/ #[fg=colour71]┃/')
echo -n "$Torrent"
#### ━━━━━━━━━━━━ # }}}
# {{{ #### Manga Update
File=~/Update\ Mangas\ History.md
Date=$(date '+%d/%m/%Y')
[ ! -f "$File" ] && echo -e " | Data | Titulo | Url |\n |:-----------:|:-----------:|:--------:|" >> "$File"
NManga=$(grep -c "$Date" "$File")
[ "$NManga" = 0 ] && echo -n "" || echo -n " #[fg=colour71]┃ #[fg=colour4]Manga: $NManga"
#### ━━━━━━━━━━━━ # }}}
# {{{ #### Mpc Player
Player=$(mpc -f "[[%artist% ┃ ]%title%]|[%file$]" 2>/dev/null \
	| grep -v 'volume:' \
	| sed -r '1!d;s/(.* )┃( .*)/ #[fg=colour71]┃ 🎵 \1-#[fg=colour5]\2/')
echo -n "$Player"
#### ━━━━━━━━━━ # }}}
# {{{ #### Temperatura CPU
Temp=$(sensors | sed -r '/Package id 0:/!d;s/.*\+(.*)\..°C *\(.*$/ #[fg=colour71]┃ \1°C/')
echo -n "$Temp"
#### ━━━━━━━━━━━━━━━ # }}}
}

####### Atualiza a Cada Minuto #######
if [ "$(date -r /tmp/tmux_bar_sleep1 +%M)" = "$(date '+%M')" ]; then
	cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
else
	tmux_bar_sleep1 > /tmp/tmux_bar_sleep1 && cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
fi
#######━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
