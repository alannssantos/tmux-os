#!/usr/bin/env bash

tmux_bar() {
### Corona Virus
corona=$(wget -qO- "https://corona-stats.online" \
	| sed '/Brazil/!d;s/â”‚/\n/g;s/ //g;s/â•‘//g' \
	| sed '1s/^/ â”ƒ \(Rank: /;3s/^/\) ðŸ˜· /;5s/^/ ðŸ’€ /;7s/^/ ðŸ˜„ /' \
	| sed '/ /!d' \
	| sed ':a;$!N;s/\n//;ta;')
################

### Update Package
update=$(aptitude show ~U | sed '/Pacote:/!d' | wc -l)
##################

### Coins
lbc=$(wget -qO- "brl.rate.sx/lbc" \
	| grep median \
	| grep -Eo '.\...' \
	| sed -e '2!d' -e 's/^/ â”ƒ ðŸ“š /')

dollar=$(wget -qO- "https://dolarhoje.com" \
        | grep "value=\"" \
	| sed "s/^.*value=\"//;s/\"\/><.*$//;s/^/ â”ƒ ðŸ’¸ /")
#########

### Internet
internet=$(sed -e '/up\|down/!d' -e 's/down/ â”ƒ âŽ/;s/up/ â”ƒ ðŸŒ/' /sys/class/net/*/operstate \
	| sed ':a;$!N;s/\n/ /;ta;')
############

### Manga Update
file=~/Update\ Mangas\ History.md
date=$(date '+%d/%m/%Y')

[ ! -f "$file" ] \
&& echo -e " | Data | Titulo | Url |\n |:-----------:|:-----------:|:--------:|" >> "$file"
 
NManga=$(grep -c "$date" "$file")
################

### Transmission
torrent=$(stig ls \
	| awk '{print $7" "$9}' \
	| sort \
	| sed 's/.*100.*/âœ…/g;s/.*stopped.*/ðŸ”´/g;s/.*seeding.*/ðŸŒ±/g;s/.*connected.*\|.*idle.*\|.*discovering.*/âŒ›ï¸/g;s/.*uploading.*/ðŸ”¼/g;s/.*downloading/ðŸ”½[/g;s/\..*$/%]/' \
	| uniq -c \
	| sed 's/ //g' \
	| sed ':a;$!N;s/\n/ /;ta;' \
	| sed 's/^/ â”ƒ /')
################

####### Exec #######
[ "$update" = 0 ] && echo -n "" || echo -n " â”ƒ ðŸ“¦ Updates: $update"
[ "$NManga" = 0 ] && echo -n "" || echo -n " â”ƒ Manga: $NManga"
echo -n "$torrent"
echo -n "$corona"
echo -n "$dollar$lbc"
echo -n "$internet"
####################
}

####### Atualiza a Cada Minuto #######
if [ "$(date -r /tmp/tmux_bar +%M)" = "$(date '+%M')" ]; then
        cat /tmp/tmux_bar 
else
        tmux_bar > /tmp/tmux_bar && cat /tmp/tmux_bar
fi
######################################
