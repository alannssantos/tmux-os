#!/usr/bin/env bash

tmux_bar_sleep1() {
#### Update Package
Update=$(apt list --upgradable | sed '/\//!d' | wc -l)
[ "$Update" = 0 ] && echo -n "" || echo -n " #[fg=green]â”ƒ #[fg=yellow]ğŸ“¦ Updates: $Update"
####â”â”â”â”â”â”â”â”â”â”â”â”â”â”
}

tmux_bar_inst(){
#### Transmission
Torrent=$(stig ls \
	| awk '{print $7" "$9}' \
	| sed 's/.*seeding.*\|.*uploading.*/#\[fg=green\] ğŸŒ±/g
		s/.*100.*/#\[fg=blue\] âœ…/g
		s/.*stopped.*/#\[fg=red\] ğŸ”´/g
		s/.*connected.*\|.*idle.*\|.*discovering.*\|.*queued.*/#\[fg=yellow\] âŒ›ï¸/g
		s/.*downloading/#\[fg=magenta\] ğŸ”½[/g;s/\..*$/%]/
		s/.*verifying/#\[fg=yellow\] âŒ›ï¸[/g;s/\..*$/%]/' \
	| sort \
	| uniq -c \
	| awk '{print $2$1$3$4}' \
	| sed ':a;$!N;s/\n/ /;ta;' \
	| sed 's/^/ #[fg=green]â”ƒ /')
echo -n "$Torrent"
####â”â”â”â”â”â”â”â”â”â”â”â”

#### Manga Update
File=~/Update\ Mangas\ History.md
Date=$(date '+%d/%m/%Y')
[ ! -f "$File" ] && echo -e " | Data | Titulo | Url |\n |:-----------:|:-----------:|:--------:|" >> "$File"
NManga=$(grep -c "$Date" "$File")
[ "$NManga" = 0 ] && echo -n "" || echo -n " #[fg=green]â”ƒ #[fg=blue]Manga: $NManga"
####â”â”â”â”â”â”â”â”â”â”â”â”

#### Mpc Player
Player=$(mpc -f "[[%artist% - ]%title%]|[%file$]" 2>/dev/null \
	| grep -v 'volume:' \
	| sed -r '1!d;s/(.* )-( .*)/ #[fg=green]â”ƒ ğŸµ \1-#[fg=magenta]\2/')
echo -n "$Player"
####â”â”â”â”â”â”â”â”â”â”

#### Temperatura CPU
Temp=$(sensors | sed -r '/Package id 0:/!d;s/.*\+(.*)\..Â°C *\(.*$/ #[fg=green]â”ƒ ğŸŒ¡ï¸ \1Â°C/')
echo -n "$Temp"
####â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

#### Internet
Internet=$(sed '/up\|down/!d;s/down//;s/up/ #[fg=green]â”ƒ ğŸŒ/' /sys/class/net/*/operstate \
	| sed ':a;$!N;s/\n/ /;ta;')
echo -n "$Internet"
####â”â”â”â”â”â”â”â”
}

####### Atualiza a Cada Minuto #######
if [ "$(date -r /tmp/tmux_bar_sleep1 +%M)" = "$(date '+%M')" ]; then
	cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
else
	tmux_bar_sleep1 > /tmp/tmux_bar_sleep1 && cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
fi
#######â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
